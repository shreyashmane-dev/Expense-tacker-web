<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Home - Expense Manager</title>
<link rel="stylesheet" href="../css/main.css">
<link rel="manifest" href="../manifest.json">
<script type="module" src="../js/auth-guard.js"></script>
</head>
<body class="animate-up">

<div class="navbar">
  <a data-page="home" href="home.html" class="nav-link active">
    <span>ğŸ </span>Home
  </a>
  <a data-page="history" href="history.html" class="nav-link">
    <span>ğŸ“œ</span>History
  </a>
  <a data-page="analysis" href="analysis.html" class="nav-link">
    <span>ğŸ“Š</span>Analysis
  </a>
  <a data-page="profile" href="profile.html" class="nav-link">
    <span>ğŸ‘¤</span>Profile
  </a>
</div>

<main class="container">
  <!-- Summary Header -->
  <div class="summary-grid">
    <div class="stat-item">
      <span class="label">Balance</span>
      <div id="balance" class="value">â‚¹0</div>
    </div>
    <div class="stat-item">
      <span class="label" style="color: var(--accent);">Income</span>
      <div id="income" class="value" style="color: var(--accent);">â‚¹0</div>
    </div>
    <div class="stat-item">
      <span class="label" style="color: var(--danger);">Expense</span>
      <div id="expense" class="value" style="color: var(--danger);">â‚¹0</div>
    </div>
  </div>

  <!-- Budget Card -->
  <div class="card budget-card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
      <h3 style="font-size: 18px;">Monthly Budget</h3>
      <span id="budgetStatus" style="font-size: 14px; font-weight: 700; color: var(--primary);">â‚¹0 / â‚¹0</span>
    </div>
    <div style="width:100%; height:10px; background:#e2e8f0; border-radius:10px; overflow:hidden;">
      <div id="budgetProgress" style="width:0%; height:100%; background: var(--grad-main); transition: width 0.5s ease;"></div>
    </div>
    <p id="budgetHint" style="font-size:12px; color:#64748b; margin-top:10px;">Set your budget in Profile settings.</p>
  </div>

  <div class="grid-2">
    <!-- Left Column: Forms & AI -->
    <div class="col-left">
      <div class="card">
        <h3>Quick Add</h3>
        <div class="form-group">
          <input type="number" id="amount" placeholder="Amount (e.g. 500)" />
          <select id="type">
            <option value="expense">Expense</option>
            <option value="income">Income</option>
          </select>
          <select id="category">
            <option value="Food">ğŸ” Food</option>
            <option value="Bills">ğŸ’¡ Bills</option>
            <option value="Travel">ğŸš— Travel</option>
            <option value="Shopping">ğŸ›ï¸ Shopping</option>
            <option value="Entertainment">ğŸ¬ Entertainment</option>
            <option value="Health">ğŸ¥ Health</option>
            <option value="Education">ğŸ“š Education</option>
            <option value="UPI">ğŸ“± UPI</option>
            <option value="Salary">ğŸ’° Salary</option>
            <option value="Gift">ğŸ Gift</option>
            <option value="Other">ğŸ“¦ Other</option>
          </select>
          <select id="source">
            <option value="cash">ğŸ’µ Cash</option>
            <option value="phonepe">ğŸ“± PhonePe</option>
            <option value="gpay">ğŸ“² Google Pay</option>
            <option value="paytm">ğŸ’³ Paytm</option>
            <option value="bank">ğŸ¦ Bank</option>
            <option value="card">ğŸ’³ Card</option>
          </select>
          <input type="text" id="note" placeholder="Note (optional)" />
          <button id="addTxnBtn" class="btn">Add Transaction</button>
        </div>
      </div>

      <div class="card">
        <h3>AI Smart Insights</h3>
        <div id="aiOutput" style="margin-bottom:12px; color:#475569; font-size: 14px; min-height: 40px;">Ask me about your spending...</div>
        <div style="display:flex; gap:8px;">
          <input type="text" id="aiInput" placeholder="Try 'How is my balance?'" style="flex:1; margin-bottom: 0;">
          <button id="aiAskBtn" class="btn" style="width:auto; padding: 10px 20px;">Ask</button>
        </div>
      </div>

      <div class="card">
        <h3>Import Tools</h3>
        <div style="margin-bottom: 16px;">
          <label style="font-size: 14px; font-weight: 600; display: block; margin-bottom: 8px;">Bank SMS Parser</label>
          <textarea id="smsText" placeholder="Paste bank SMS here..." style="height:80px;"></textarea>
          <button id="simulateSmsBtn" class="btn btn-secondary">Import SMS</button>
        </div>
        <div>
          <label style="font-size: 14px; font-weight: 600; display: block; margin-bottom: 8px;">Push Notifications</label>
          <div style="display:flex; align-items:center; gap:12px;">
            <label style="display:flex; align-items:center; gap:8px; font-size: 14px;">
              <input type="checkbox" id="notifToggle" style="width: auto; margin:0;"> Active
            </label>
            <button id="openNotifSettingsBtn" style="background: none; border: none; color: var(--primary); font-size: 13px; text-decoration: underline; cursor: pointer;">Setup guide</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Recent -->
    <div class="col-right">
      <div class="card" style="min-height: 400px;">
        <h3>Recent Activity</h3>
        <ul id="transactionsUl" class="txn-list">
          <!-- Populated by JS -->
        </ul>
        <div style="text-align: center; margin-top: 20px;">
          <a href="history.html" style="color: var(--primary); font-size: 14px; font-weight: 600; text-decoration: none;">View All History â†’</a>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Scripts -->
<script type="module" src="../js/app.js"></script>
<script type="module" src="../js/home.js"></script>
<script type="module" src="../js/transactions.js"></script>
<script type="module">
  import { getAllTransactions } from "../js/transactions.js";
  import { getCategoryIcon } from "../js/constants.js";

  function renderRecent() {
    const ul = document.getElementById('transactionsUl');
    if (!ul) return;
    const txns = getAllTransactions();
    if (!txns.length) { 
      ul.innerHTML = '<li style="text-align:center; padding:40px; color:#94a3b8; font-size:14px;">No transactions yet. Add your first one above!</li>'; 
      return; 
    }
    
    ul.innerHTML = txns.slice(0, 10).map(t => `
      <li class="txn-item">
        <div style="display:flex; align-items:center;">
          <div class="txn-icon">${getCategoryIcon(t.category)}</div>
          <div class="txn-info">
            <div class="txn-name">${t.category}</div>
            <div class="txn-meta">${t.note || 'No note'} â€¢ ${t.date}</div>
          </div>
        </div>
        <div class="txn-amount ${t.type}">
          ${t.type === 'expense' ? '-' : '+'}â‚¹${t.amount.toLocaleString()}
        </div>
      </li>
    `).join('');
  }

  document.addEventListener('DOMContentLoaded', renderRecent);
  window.addEventListener('transactionAdded', renderRecent);
</script>

</body>
</html>
