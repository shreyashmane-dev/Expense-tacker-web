const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/navbar-DKKOqqgn.js","assets/firebase-CCPgoP9_.js","assets/history-B8PwRqKd.js","assets/analysis-COzKNxjL.js"])))=>i.map(i=>d[i]);
import{a as m,d as g}from"./firebase-CCPgoP9_.js";import{onAuthStateChanged as C}from"https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";import{doc as y,setDoc as T,getDoc as w}from"https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";import{Chart as b,registerables as A}from"https://cdn.jsdelivr.net/npm/chart.js@4.4.1/+esm";console.log("Auth Guard: Initializing...");C(m,e=>{const r=window.location.pathname.includes("/auth/"),s=sessionStorage.getItem("guest_mode")==="true";e||s?(console.log("âœ… Auth Guard: User authorized (User or Guest)"),r&&window.location.replace("/dashboard/home.html")):(console.warn("â›” Auth Guard: No user found."),r||window.location.replace("/auth/login.html"))});const N="modulepreload",P=function(e){return"/"+e},_={},u=function(t,r,s){let c=Promise.resolve();if(r&&r.length>0){let a=function(i){return Promise.all(i.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=n?.nonce||n?.getAttribute("nonce");c=a(r.map(i=>{if(i=P(i),i in _)return;_[i]=!0;const f=i.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const l=document.createElement("link");if(l.rel=f?"stylesheet":N,f||(l.as="script"),l.crossOrigin="",l.href=i,o&&l.setAttribute("nonce",o),document.head.appendChild(l),f)return new Promise((O,B)=>{l.addEventListener("load",O),l.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${i}`)))})}))}function d(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return c.then(n=>{for(const o of n||[])o.status==="rejected"&&d(o.reason);return t().catch(d)})},v="expense_transactions";function h(){return JSON.parse(localStorage.getItem(v))||[]}async function E(e){if(localStorage.setItem(v,JSON.stringify(e)),m.currentUser&&navigator.onLine)try{const t=y(g,"transactions",m.currentUser.uid);await T(t,{data:e,lastSynced:Date.now()},{merge:!0}),console.log("â˜ï¸ Data Synced to Cloud")}catch(t){console.error("Cloud Sync Error:",t)}}async function D(){if(m.currentUser&&navigator.onLine)try{const e=y(g,"transactions",m.currentUser.uid),t=await w(e);if(t.exists()){const c=t.data().data||[],d=h(),n=[...c];d.forEach(o=>{n.find(a=>a.id===o.id)||n.push(o)}),localStorage.setItem(v,JSON.stringify(n)),console.log("ğŸ”„ Merged Transactions from Cloud")}const r=y(g,"users",m.currentUser.uid),s=await w(r);if(s.exists()){const c=s.data();c.monthlyBudget&&(localStorage.setItem("monthlyBudget",c.monthlyBudget),console.log("ğŸ”„ Merged Budget from Cloud"))}window.dispatchEvent(new Event("transactionAdded"))}catch(e){console.warn("Could not sync from cloud",e)}}function S(e){const t=h();t.unshift(e),E(t)}function k(e){const t=h().filter(r=>r.id!==e);E(t)}const j=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:S,deleteTransaction:k,getTransactions:h,saveTransactions:E,syncFromCloud:D},Symbol.toStringTag,{value:"Module"}));b.register(...A);function R(){const e=h().filter(n=>n.type==="expense"),t={};e.forEach(n=>{const o=Number(n.amount)||0;t[n.category]=(t[n.category]||0)+o});const r=document.getElementById("categoryChart");r&&(window.categoryChart&&window.categoryChart.destroy(),window.categoryChart=new b(r.getContext("2d"),{type:"pie",data:{labels:Object.keys(t),datasets:[{data:Object.values(t),backgroundColor:["#60a5fa","#93c5fd","#bfdbfe","#38bdf8","#7dd3fc","#34d399","#fb7185"]}]},options:{responsive:!0,maintainAspectRatio:!1}}));const s={};e.forEach(n=>{const o=new Date(n.date),a=isNaN(o)?n.date:o.toLocaleString("default",{month:"short",year:"numeric"});s[a]=(s[a]||0)+(Number(n.amount)||0)});const c=document.getElementById("trendChart");c&&(window.trendChart&&window.trendChart.destroy(),window.trendChart=new b(c.getContext("2d"),{type:"line",data:{labels:Object.keys(s),datasets:[{label:"Monthly Expense",data:Object.values(s),borderColor:"#2563eb",fill:!0,backgroundColor:"rgba(37,99,235,0.15)"}]},options:{responsive:!0,maintainAspectRatio:!1}}));const d=document.getElementById("insights");if(d){const n=Object.entries(t).sort((a,i)=>i[1]-a[1])[0],o=e.reduce((a,i)=>a+(Number(i.amount)||0),0);d.innerHTML=`
      <h3>Insights</h3>
      <p>ğŸ’¸ Highest spending category: <b>${n?.[0]||"N/A"}</b></p>
      <p>ğŸ“Š Total expenses: â‚¹${o}</p>
    `}}const U=Object.freeze(Object.defineProperty({__proto__:null,renderCharts:R},Symbol.toStringTag,{value:"Module"}));function I(e){e=(e||"").toLowerCase();const t=h()||[];if(e.includes("balance")){let n=0,o=0;return t.forEach(a=>{a.type==="income"?n+=Number(a.amount)||0:o+=Number(a.amount)||0}),`Your balance is â‚¹${(n-o).toLocaleString()}`}if(e.includes("today")){const n=new Date().toISOString().split("T")[0];return`You spent â‚¹${t.filter(a=>a.date===n&&a.type==="expense").reduce((a,i)=>a+(Number(i.amount)||0),0).toLocaleString()} today`}const r=["food","shopping","travel","upi","entertainment","salary","bills"];for(let n of r)if(e.includes(n))return`You spent â‚¹${t.filter(a=>(a.category||"").toLowerCase()===n&&a.type==="expense").reduce((a,i)=>a+(Number(i.amount)||0),0).toLocaleString()} on ${n}`;const s=e.match(/(\d+[\d,]*)/)?.[1]?.replace(/,/g,"");if(e.includes("add")&&s){const n=Number(s),o={id:Date.now(),amount:n,type:e.includes("income")?"income":"expense",category:"AI",date:new Date().toISOString().split("T")[0],source:"ai"};return S(o),`Added â‚¹${n.toLocaleString()} transaction successfully`}const c=new Date().toISOString().slice(0,7);return t.filter(n=>(n.date||"").startsWith(c)&&n.type==="expense").reduce((n,o)=>n+(Number(o.amount)||0),0)>1e4?"âš ï¸ You are overspending this month. Consider reducing expenses.":"ğŸ¤– I can help with balance, spending, add expense, and insights."}typeof window<"u"&&(window.askAI=I);console.log("App Controller Loaded");function $(){const e=location.pathname.split("/").pop().replace(".html","");document.querySelectorAll(".navbar a").forEach(t=>{t.dataset.page===e&&t.classList.add("active")})}document.addEventListener("DOMContentLoaded",$);document.addEventListener("click",e=>{e.target.tagName==="BUTTON"&&(e.target.style.transform="scale(0.95)",setTimeout(()=>e.target.style.transform="scale(1)",120))});window.Capacitor?.isNativePlatform&&window.Capacitor.isNativePlatform()&&document.addEventListener("click",()=>{try{Capacitor.Plugins.Haptics.impact({style:"light"})}catch{}});C(m,e=>{e&&(u(()=>Promise.resolve().then(()=>j),void 0).then(t=>t.syncFromCloud()),M())});function M(){V(),q()}function V(){if(document.querySelector(".navbar"))return;const e=document.getElementById("navbar");e&&fetch("/dashboard/navbar.html").then(t=>t.text()).then(t=>{e.innerHTML=t,u(()=>import("./navbar-DKKOqqgn.js"),__vite__mapDeps([0,1])).then(r=>{r.initNavbar&&r.initNavbar()}).catch(r=>{console.error("Failed to load navbar.js:",r)})}).catch(t=>{console.error("Failed to load navbar.html:",t)})}function q(){document.getElementById("income")&&(document.querySelector('script[src$="home.js"]')||u(()=>import("./home-C2dY39wA.js").then(t=>t.h),[]).catch(t=>console.error("home load failed",t))),(document.getElementById("historyList")||document.getElementById("transactionsUl"))&&(document.querySelector('script[src$="history.js"]')||u(()=>import("./history-B8PwRqKd.js"),__vite__mapDeps([2,1])).catch(t=>console.error("history load failed",t))),(document.getElementById("categoryChart")||document.getElementById("trendChart")||document.getElementById("incomeExpenseChart"))&&(document.querySelector('script[src$="analysis.js"]')||u(()=>import("./analysis-COzKNxjL.js"),__vite__mapDeps([3,1])).catch(t=>console.error("analysis load failed",t)));const e=document.getElementById("aiAskBtn");e&&e.addEventListener("click",()=>{const t=document.getElementById("aiInput"),r=document.getElementById("aiOutput");t.value.trim()&&(r.textContent=I(t.value),t.value="")})}window.addEventListener("transactionAdded",()=>{(document.getElementById("transactionsUl")||document.getElementById("historyList"))&&u(()=>import("./history-B8PwRqKd.js"),__vite__mapDeps([2,1])).then(e=>{}).catch(()=>{}),(document.getElementById("categoryChart")||document.getElementById("trendChart"))&&u(()=>Promise.resolve().then(()=>U),void 0).then(e=>{e.renderCharts&&e.renderCharts()}),document.getElementById("income")&&u(()=>import("./home-C2dY39wA.js").then(e=>e.h),[]).then(()=>{}).catch(()=>{})});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")});window.addEventListener("offline",()=>{const e=document.createElement("div");e.id="connection-status",e.style="position:fixed; bottom:80px; left:50%; transform:translateX(-50%); background:#ef4444; color:white; padding:8px 16px; border-radius:30px; font-size:12px; font-weight:bold; z-index:9999; box-shadow:0 10px 25px rgba(239,68,68,0.4); border:1px solid rgba(255,255,255,0.2); backdrop-filter:blur(10px); animation: slideUp 0.4s ease;",e.innerHTML="<span>âš ï¸ Offline Mode</span>",document.body.appendChild(e)});window.addEventListener("online",()=>{const e=document.getElementById("connection-status");e&&(e.style.background="#10b981",e.style.boxShadow="0 10px 25px rgba(16,185,129,0.4)",e.innerHTML="<span>ğŸŒ Back Online! Syncing...</span>",setTimeout(()=>e.remove(),3e3))});const L=document.createElement("style");L.textContent=`
@keyframes slideUp {
  from { transform: translate(-50%, 50px); opacity: 0; }
  to { transform: translate(-50%, 0); opacity: 1; }
}
`;document.head.appendChild(L);let x=0;document.addEventListener("touchstart",e=>{x=e.touches[0].clientX});document.addEventListener("touchend",e=>{const r=e.changedTouches[0].clientX-x,s=["home.html","history.html","analysis.html","profile.html"],c=s.indexOf(location.pathname.split("/").pop());r<-80&&c<s.length-1&&(location.href=s[c+1]),r>80&&c>0&&(location.href=s[c-1])});export{u as _,S as a,h as g};
